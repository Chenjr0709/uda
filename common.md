# 操作指南

{{indexmenu_n>2}}

## 创建主机开启数据方舟

### 开启数据方舟

您在创建主机时，可以开启数据方舟。

![image](/images/uda1.png)

### 数据方舟使用注意事项

创建主机后，数据方舟需要约10分钟进行初始化。

## 管理数据方舟

### 数据方舟入口

您创建主机并开启数据方舟后，在主机资源列表中选中主机，在磁盘与恢复Tab中点击“进入方舟”，即可进入数据方舟备份管理。

![image](/images/uda2.png)

### 数据方舟备份管理

您进入数据方舟备份管理后，可以查看系统盘备份链和数据盘备份链的相关信息，如下图所示。

![image](/images/uda3.png)

## 数据方舟备份方式

### 自动备份

系统盘和数据盘拥有三种备份形式，分别是：

* 12小时秒级备份：12小时内最新的数据，可通过数据方舟恢复到任意1秒的数据状态； 
* 24小时内每小时整点备份：12小时到24小时之间的数据，可按照整点进行小时级别的数据恢复；
* 3天内每天零点备份：24小时到3天之间的数据，可按照每天零点进行天级的数据恢复。


   注：自动备份的数据不可删除。

#### 秒级备份

（1）查看12小时秒级备份

您在备份管理中可以查看12小时秒级备份的相关信息。

![image](/images/uda4.png)

（2）恢复12小时秒级备份

在数据方舟中点击“恢复”即可选择12小时内的时间点将系统盘或数据盘进行恢复。

   注：在恢复前请先关闭主机。

![image](/images/uda5.png)

#### 整点备份和零点备份

（1）查看24小时整点备份和3天内零点备份

您在备份管理中可以查看24小时整点备份和3天内零点备份的相关信息。

![image](/images/uda6.png)

（2）恢复24小时整点备份和3天内零点备份

您在备份管理点击“恢复”即可选择24小时整点或3天内零点将系统盘或数据盘进行恢复。

   注：在恢复前请先关闭主机。

![image](/images/uda5.png)

### 手动备份

#### 创建手动备份

您也可以选择手动创建备份，在备份管理选择“创建备份”。

![image](/images/uda8.png)

手动创建备份时，时间点即为您当前操作的时间点，您可以选择分别备份系统盘、数据盘或两者均进行备份，您还可以自定义备份名称和备份描述。

![image](/images/uda9.png)

#### 恢复手动备份

您可以在备份管理点击“恢复”，进入备份恢复。

![image](/images/10.png)

您进入备份恢复页面后，点击“选择备份”，可以选择您创建的手动备份，选择完成后，可以进行恢复操作。

![image](/images/11.png)

#### 升级配置

在主机管理列表选中单台云主机后，右侧详细面板可以选择升级配置按钮

![image](/images/select_reconfig.png)

在弹出窗口中选择要修改的配置，注意升级配置需要关闭云主机，若当前云主机处于开机状态，需要勾选下图箭头所指的复选框确认，否则”确定”按钮不可用。

![image](/images/reconfig.png)

升级完成后，机器处于关机状态，需要手动点击”启动”按钮开机。

注意，如果对数据盘进行了升级，升级之后还需要登录云主机进行磁盘扩容操作：

**Linux操作系统**

`%%对于有数据盘扩容的主机（适用于开启数据方舟的主机）%%`

例：

10：00，您的主机（已开启数据方舟）当前数据盘容量为20G；

11：00，您对主机进行升级操作，将数据盘扩容至100G；

13：00，您需要恢复数据盘至10：00。

此时您需要进行如下操作：

*查看数据盘的文件系统类型（升级操作需要针对ext4和xfs两种文件系统采取不同的操作）*

    df -ihT

![image](/images/ext4.png)

![image](/images/xfs.png)

*针对ext4文件格式的操作系统（如CentOS6）：*

    umount /dev/vdb
    e2fsck -f /dev/vdb
    resize2fs /dev/vdb
    mount /dev/vdb /data

*针对xfs文件格式的操作系统（如CentOS7）*

    umount /dev/vdb
    xfs_repair /dev/vdb
    mount /dev/vdb /data
    xfs_growfs /data

`%%对于升级之前无数据盘的主机%%`

关机升级后，需在云主机内做如下操作：

可选择ext4或xfs两种文件系统格式来格式化数据盘

*将数据盘设置为ext4文件格式（CentOS6的默认文件系统格式）：*

    mkfs -t ext4 /dev/vdb 
    mount /dev/vdb /data/

编辑/etc/fstab，将对应配置写入fatab

    /dev/vdb   /data  ext4  defaults,noatime 0 0

*将数据盘设置为xfs格式（CentOS7的默认文件系统格式）：*

    mkfs.xfs /dev/vdb
    mount -t xfs /dev/vdb /data

编辑/etc/fstab，加入如下内容

    /dev/vdb /data xfs defaults,noatime 0 0

**Windows操作系统**

在主机上操作，cmd中输入diskpart.exe，list volume，选择要扩展大小的逻辑卷，输入要扩展大小extend
\[size=n\]， 或extend将所有未分配大小扩展到选择的逻辑卷

![image](/images/disk_extend.png)
